doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Myth Journey – Page 1

    // Fonts
    link(rel="preconnect", href="https://fonts.googleapis.com")
    link(rel="preconnect", href="https://fonts.gstatic.com", crossorigin)
    link(
      href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@100..900&display=swap",
      rel="stylesheet"
    )

    // Main CSS
    link(rel="stylesheet", href="assets/css/style.css")

    // Font Awesome
    link(
      rel="stylesheet",
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    )

    // GSAP
    script(src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js")

    style.
      .logo-container.fixed {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 999;
      }

  body.page1(class=isHome ? 'home-page' : '')

    // =======================
    // LOGO CONTAINER
    // =======================
    .logo-container
      img.logo-trigger.logo1(src="/images/red-arrow-logo.png", alt="Red Logo")

    // =======================
    // OVERLAY
    // =======================
    .overlay
      .outer
        .top-icon.arrow
          img(src="/images/menu-arrow.png", alt="Close")

        .stage#stage
          .carousel#carousel
            .item.side(
              data-route="/open-studio"
              data-label="OPEN STUDIO"
            )
              span (05)
              |  OPEN
              br
              |  STUDIO

            .item.side(
              data-route="/design-lab"
              data-label="DESIGN LAB"
            )
              span (02)
              |  DESIGN
              br
              |  LAB

            .item.main(
              data-route="/myth-journey"
              data-label="MYTH JOURNEY"
            )
              span (01)
              |  MYTH
              br
              |  JOURNEY

            .item.side(
              data-route="/myth-creation"
              data-label="MYTH CREATION"
            )
              span (03)
              |  MYTH
              br
              |  CREATION

            .item.side(
              data-route="/vision-quest"
              data-label="VISION QUEST"
            )
              span (04)
              |  VISION
              br
              |  QUEST

            .item.side(
              data-route="/future-project"
              data-label="FUTURE PROJECT"
            )
              span (06)
              |  FUTURE
              br
              |  PROJECT

        .social-icons
          span
            img(src="/images/facebook-icon.png", alt="Facebook")
          span
            img(src="/images/linkdin-icon.png", alt="LinkedIn")
          span
            img(src="/images/instagram-icon.png", alt="Instagram")

    // =====================
    // CAROUSEL SCRIPT
    // =====================
    script.
      const carousel = document.getElementById('carousel');
      const items = carousel.querySelectorAll('.item');

      let isDragging = false;
      let startX = 0;
      let currentRotation = 0;
      let dragRotation = 0;

      const sensitivity = 0.25;
      const itemCount = items.length;
      const degreePerItem = 360 / itemCount;

      // START DRAG
      carousel.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX;
        carousel.style.transition = 'none';
      });

      // DRAG MOVE (DOCUMENT!)
      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        const delta = e.clientX - startX;
        dragRotation = currentRotation + delta * sensitivity;
        carousel.style.transform = `rotateY(${dragRotation}deg)`;
        updateHighlight(dragRotation);
      });

      // END DRAG
      document.addEventListener('mouseup', () => {
        if (!isDragging) return;
        isDragging = false;
        currentRotation = Math.round(dragRotation / degreePerItem) * degreePerItem;
        carousel.style.transition = 'transform 0.8s cubic-bezier(0.23,1,0.32,1)';
        carousel.style.transform = `rotateY(${currentRotation}deg)`;
        updateHighlight(currentRotation);
      });

      function updateHighlight(rotation) {
        const normalized = ((rotation % 360) + 360) % 360;
        const centerIndex = Math.round(normalized / degreePerItem) % itemCount;

        items.forEach((item, index) => {
          if (index === (itemCount - centerIndex) % itemCount) {
            item.classList.add('main');
            item.classList.remove('side');
          } else {
            item.classList.add('side');
            item.classList.remove('main');
          }
        });
      }


    // =====================
    // OVERLAY OPEN / CLOSE
    // =====================
    script.
      const overlay = document.querySelector('.overlay');
      const logo = document.querySelector('.logo1');
      const arrow = document.querySelector('.arrow img');

      gsap.set(overlay, { y: "100%", display: "none" });

      logo.addEventListener('click', () => {
        overlay.style.display = "block";
        gsap.to(overlay, { y: 0, duration: 1, ease: "power4.out" });
      });

      arrow.addEventListener('click', () => {
        gsap.to(overlay, {
          y: "100%",
          duration: 1,
          ease: "power4.in",
          onComplete: () => overlay.style.display = "none"
        });
      });

    // =====================
    // MENU ITEM CLICK → LOADING PAGE
    // =====================
    script.
      document.querySelectorAll('.carousel .item').forEach(item => {
        item.addEventListener('click', () => {
          if (!item.classList.contains('main')) return;

          const route = item.dataset.route;
          const label = item.dataset.label;

          console.log('NAVIGATING →', label);

          window.location.replace(
            `/loading?to=${encodeURIComponent(route)}&label=${encodeURIComponent(label)}`
          );
        });
      });

    // =====================
    // LOGO SCROLL SHOW / HIDE + FIXED POSITION
    // =====================
    script.
      const logoContainer = document.querySelector('.logo-container');

      let lastScrollY = window.scrollY;
      const scrollThreshold = 10;

      gsap.set(logoContainer, { y: 0, opacity: 1 });

      window.addEventListener('scroll', () => {
        const currentScrollY = window.scrollY;

        if (Math.abs(currentScrollY - lastScrollY) < scrollThreshold) return;

        if (currentScrollY > lastScrollY && currentScrollY > 50) {
          logoContainer.classList.remove('fixed');
          gsap.to(logoContainer, {
            y: -100,
            opacity: 0,
            duration: 0.4,
            ease: "power3.out"
          });
        } else {
          logoContainer.classList.add('fixed');
          gsap.to(logoContainer, {
            y: 0,
            opacity: 1,
            duration: 0.4,
            ease: "power3.out"
          });
        }

        lastScrollY = currentScrollY;
      });
