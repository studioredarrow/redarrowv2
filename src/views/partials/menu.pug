doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Myth Journey â€“ Page 1

    // Fonts + CSS
    link(rel="preconnect", href="https://fonts.googleapis.com")
    link(rel="preconnect", href="https://fonts.gstatic.com", crossorigin)
    link(href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@100..900&display=swap", rel="stylesheet")
    link(rel="stylesheet", href="assets/css/style.css")

    // Font Awesome
    link(
      rel="stylesheet",
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    )

  body.page1
    // =======================
    //  LOGO + OVERLAY STRUCTURE
    // =======================

    .logo-container
      // Both logos present; CSS decides which to show
      img.logo-trigger.logo1(src="/images/red-arrow-logo.png", alt="Red Logo")
      img.logo-trigger.logo2(src="/images/blue-arrow-logo.png", alt="Blue Logo")

    // Overlay Page (initially hidden)
    .overlay
      .outer
        .top-icon.arrow
          img(src="/images/menu-arrow.png", alt="Close")

        .stage#stage
          .carousel#carousel
            .item.side
              span (05)
              |  OPEN
              br
              |  STUDIO
            .item.side
              span (02)
              |  DESIGN
              br
              |  LAB
            .item.main
              span (01)
              |  MYTH
              br
              |  JOURNEY
            .item.side
              span (03)
              |  MYTH
              br
              |  CREATION
            .item.side
              span (04)
              |  VISION
              br
              |  QUEST
            .item.side
              span (06)
              |  FUTURE
              br
              |  PROJECT

        .social-icons
          span
            img(src="/images/facebook-icon.png", alt="Facebook")
          span
            img(src="/images/linkedin-icon.png", alt="LinkedIn")
          span
            img(src="/images/instagram-icon.png", alt="Instagram")

    // =====================
    //  JS + Animations
    // =====================
    script(src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js")

    script.
      const carousel = document.getElementById('carousel');
      const items = carousel.querySelectorAll('.item');
      let isDragging = false;
      let startX = 0;
      let currentRotation = 0;
      let dragRotation = 0;
      const sensitivity = 0.2;
      const itemCount = items.length;
      const degreePerItem = 360 / itemCount;

      window.addEventListener('mousedown', dragStart);
      window.addEventListener('mousemove', dragMove);
      window.addEventListener('mouseup', dragEnd);
      window.addEventListener('touchstart', (e) => dragStart(e.touches[0]));
      window.addEventListener('touchmove', (e) => dragMove(e.touches[0]));
      window.addEventListener('touchend', dragEnd);

      function dragStart(e) {
        isDragging = true;
        startX = e.pageX;
        carousel.style.transition = 'none';
      }

      function dragMove(e) {
        if (!isDragging) return;
        const x = e.pageX;
        const walk = (x - startX) * sensitivity;
        dragRotation = currentRotation + walk;
        carousel.style.transform = `rotateY(${dragRotation}deg)`;
        updateHighlight(dragRotation);
      }

      function dragEnd() {
        if (!isDragging) return;
        isDragging = false;
        currentRotation = Math.round(dragRotation / degreePerItem) * degreePerItem;
        carousel.style.transition = 'transform 0.8s cubic-bezier(0.23, 1, 0.32, 1)';
        carousel.style.transform = `rotateY(${currentRotation}deg)`;
        updateHighlight(currentRotation);
      }

      function updateHighlight(rotation) {
        const normalizedRotation = ((rotation % 360) + 360) % 360;
        const centerIndex = Math.round(normalizedRotation / degreePerItem) % itemCount;
        items.forEach((item, index) => {
          if (index === (itemCount - centerIndex) % itemCount) {
            item.classList.add('main');
            item.classList.remove('side');
          } else {
            item.classList.add('side');
            item.classList.remove('main');
          }
        });
      }

    script.
      const overlay = document.querySelector('.overlay');
      const logo = document.querySelector('.logo1'); // Only the visible logo triggers
      const arrow = document.querySelector('.arrow img');

      gsap.set(overlay, { y: "100%", display: "none" });

      logo.addEventListener('click', () => {
        overlay.style.display = "block";
        gsap.to(overlay, { y: 0, duration: 1, ease: "power4.out" });
      });

      arrow.addEventListener('click', () => {
        gsap.to(overlay, {
          y: "100%",
          duration: 1,
          ease: "power4.in",
          onComplete: () => overlay.style.display = "none"
        });
      });
